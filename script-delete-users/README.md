# Скрипт удаления пользователей в Elma365 из PostgreSQL и MongoDB

## Описание
Этот Bash-скрипт выполняет **двухэтапное удаление пользователей** из **PostgreSQL** и **MongoDB**, предварительно очищая групповые связи.

## Функции
- Удаляет пользователей из **PostgreSQL** и **MongoDB**.
- Очищает **групповые связи** перед удалением пользователя.
- Поддерживает **внешние** и **внутренние** соединения с базами данных (через `kubectl exec`).
- Позволяет **исключать** определённых пользователей и группы из удаления.
- Генерирует **логи** для проверки.

## Использование
### Шаг 1: Подготовка списка пользователей для удаления
Перед удалением создаётся список пользователей, которых **нужно** удалить (исключая пользователей из входного файла).

#### Команда:
```sh
./users_check_delete_v03.sh prepare users.csv
```
#### Входные данные:
- `users.csv` — Файл со списком email-адресов пользователей, которых **не следует** удалять.

#### Результат:
- Создаётся файл `users-delete_YYYYmmdd_HHMMSS.CSV`, содержащий:
  - Email пользователя
  - MongoDB ID (если есть)
  - PostgreSQL ID
  - Группы пользователя (исключая заданные группы)

#### Необходимо проверить:
- **Вручную** проверить файл `users-delete_YYYYmmdd_HHMMSS.CSV` перед удалением.

## Настройки

### 1. Внешнее или внутреннее подключение
```sh
POSTGRES_ON_SEPARATE_SERVER="False"  # False -> подключение через kubectl exec
MONGO_ON_SEPARATE_SERVER="False"     # False -> подключение через kubectl exec
```

### 2. Строки подключения

#### PostgreSQL
```sh
PG_CONN_EXTERNAL="postgresql://elma365:Password@192.168.1.21:5432/elma365?sslmode=disable"
```

### 3. Исключаемые группы
```sh
EXCLUDED_GROUPS="Все пользователи"
```
